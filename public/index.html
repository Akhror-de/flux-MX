<!DOCTYPE html>
<html lang="ru" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#6a11cb">
    <meta name="description" content="Flux AI Music Mixer ‚Äî —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏–¥–µ–∞–ª—å–Ω—ã–µ –º–∏–∫—Å—ã —Å –ø–æ–º–æ—â—å—é –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞">
    <title>Flux AI Music Mixer | –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π PWA-–º–∏–∫—à–µ—Ä</title>
    
    <!-- PWA Meta -->
    <link rel="manifest" href="/manifest.json" crossorigin="use-credentials">
    <link rel="icon" href="/icons/icon-192.png" type="image/png">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Flux Mixer">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Flux AI Music Mixer">
    <meta property="og:description" content="–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏–¥–µ–∞–ª—å–Ω—ã–µ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –º–∏–∫—Å—ã —Å AI-–ø–æ–º–æ—â–Ω–∏–∫–æ–º">
    <meta property="og:image" content="/icons/icon-512.png">
    <meta property="og:url" content="https://flux-mixer.vercel.app">
    <meta property="og:type" content="website">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/style.css">
    
    <!-- AI Libraries (—á–µ—Ä–µ–∑ CDN) -->
    <script src="https://unpkg.com/tonal/browser/tonal.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web-audio-beat-detector@7.0.2/dist/web-audio-beat-detector.umd.min.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notification" class="notification" aria-live="polite" aria-atomic="true"></div>
    
    <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="app-container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="app-header">
            <div class="logo">
                <h1>üéõÔ∏è <span class="gradient-text">Flux</span></h1>
                <p class="tagline">AI Music Mixer PWA</p>
            </div>
            
            <div class="header-controls">
                <button id="installBtn" class="btn btn-install" aria-label="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ">
                    üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                </button>
                <button id="themeToggle" class="btn btn-icon" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                    üåô
                </button>
            </div>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="main-content">
            <!-- –ü–∞–Ω–µ–ª—å –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <section class="upload-section" aria-labelledby="upload-title">
                <h2 id="upload-title" class="section-title">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç–µ –º—É–∑—ã–∫—É</h2>
                <div class="upload-zone" id="uploadZone">
                    <input type="file" id="fileInput" accept="audio/*" multiple 
                           class="visually-hidden">
                    <label for="fileInput" class="upload-label">
                        <div class="upload-icon">üéµ</div>
                        <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                        <small>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: MP3, WAV, OGG, FLAC</small>
                    </label>
                    <div class="upload-progress" id="uploadProgress" hidden>
                        <div class="progress-bar" id="progressBar"></div>
                        <span id="progressText">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>
            </section>

            <!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä -->
            <section class="visualizer-section" aria-labelledby="visualizer-title">
                <h2 id="visualizer-title" class="section-title">üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä</h2>
                <div class="visualizer-container">
                    <canvas id="visualizer" width="800" height="300" 
                            aria-label="–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ"></canvas>
                </div>
            </section>

            <!-- AI –ê–Ω–∞–ª–∏–∑ -->
            <section class="ai-section" aria-labelledby="ai-title">
                <h2 id="ai-title" class="section-title">üß† AI –ê–Ω–∞–ª–∏–∑</h2>
                <div class="ai-controls">
                    <button id="analyzeBtn" class="btn btn-primary btn-ai" disabled>
                        üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç—Ä–µ–∫–∏
                    </button>
                    <button id="autoMixBtn" class="btn btn-success btn-ai" disabled>
                        ü§ñ –ê–≤—Ç–æ-–º–∏–∫—Å (AI)
                    </button>
                    <div class="ai-stats" id="aiStats">
                        <div class="stat">
                            <span class="stat-label">–¢—Ä–µ–∫–∏:</span>
                            <span id="trackCount" class="stat-value">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">BPM:</span>
                            <span id="avgBpm" class="stat-value">‚Äî</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">–ö–ª—é—á:</span>
                            <span id="commonKey" class="stat-value">‚Äî</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- –î–æ—Ä–æ–∂–∫–∏ –¥–ª—è –º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <section class="tracks-section" aria-labelledby="tracks-title">
                <h2 id="tracks-title" class="section-title">üéµ –¢—Ä–µ–∫–∏ –¥–ª—è –º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
                <div class="tracks-container" id="tracksContainer">
                    <div class="empty-state" id="emptyState">
                        <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏–µ</p>
                    </div>
                </div>
            </section>

            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã -->
            <section class="controls-section" aria-labelledby="controls-title">
                <h2 id="controls-title" class="section-title visually-hidden">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º</h2>
                <div class="player-controls">
                    <button id="playBtn" class="btn btn-play" aria-label="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ/–ø–∞—É–∑–∞">
                        ‚ñ∂Ô∏è
                    </button>
                    
                    <div class="volume-control">
                        <label for="volumeSlider" class="volume-label">üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å</label>
                        <input type="range" id="volumeSlider" min="0" max="100" value="70" 
                               class="volume-slider" aria-label="–ì—Ä–æ–º–∫–æ—Å—Ç—å">
                        <span id="volumeValue" class="volume-value">70%</span>
                    </div>
                    
                    <div class="time-control">
                        <span id="currentTime">0:00</span>
                        <input type="range" id="progressSlider" min="0" max="100" value="0" 
                               class="progress-slider" aria-label="–ü—Ä–æ–≥—Ä–µ—Å—Å —Ç—Ä–µ–∫–∞">
                        <span id="totalTime">0:00</span>
                    </div>
                    
                    <button id="stopBtn" class="btn btn-stop" aria-label="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å">
                        ‚èπÔ∏è
                    </button>
                </div>
                
                <div class="master-controls">
                    <button id="clearBtn" class="btn btn-warning">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                    </button>
                    <button id="demoBtn" class="btn btn-info">
                        üéß –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ–º–æ
                    </button>
                    <button id="recordBtn" class="btn btn-danger" disabled>
                        ‚è∫Ô∏è –ó–∞–ø–∏—Å–∞—Ç—å –º–∏–∫—Å
                    </button>
                </div>
            </section>
        </main>

        <!-- –ü–æ–¥–≤–∞–ª -->
        <footer class="app-footer">
            <div class="footer-content">
                <p>¬© 2024 Flux AI Music Mixer | PWA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | 
                   <a href="https://github.com/–≤–∞—à-username/flux-pwa" target="_blank" rel="noopener">GitHub</a>
                </p>
                <div class="pwa-status">
                    <span id="pwaStatus">PWA –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</span>
                    <span id="offlineStatus" class="offline-indicator">‚ö´ –û—Ñ–ª–∞–π–Ω</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ AI-–∞–Ω–∞–ª–∏–∑–∞ -->
    <div id="analysisModal" class="modal" role="dialog" aria-labelledby="modalTitle" hidden>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">üß† AI –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–∫–æ–≤</h3>
                <button id="closeModal" class="btn-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
            </div>
            <div class="modal-body">
                <div id="analysisResults"></div>
            </div>
        </div>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è PWA
        let deferredPrompt = null;
        let isAppInstalled = false;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ PWA
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBtn').style.display = 'flex';
            updatePWAStatus('–ì–æ—Ç–æ–≤–æ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ');
        });
        
        window.addEventListener('appinstalled', () => {
            isAppInstalled = true;
            deferredPrompt = null;
            updatePWAStatus('–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∫–∞–∫ PWA');
            showNotification('Flux —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!', 'success');
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ñ–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–∞
        window.addEventListener('online', () => {
            document.getElementById('offlineStatus').style.display = 'none';
        });
        
        window.addEventListener('offline', () => {
            document.getElementById('offlineStatus').style.display = 'inline';
        });
        
        // Service Worker —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js', {
                scope: '/'
            }).then(reg => {
                console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', reg);
                updatePWAStatus('PWA –≥–æ—Ç–æ–≤–æ');
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ Service Worker:', err);
                updatePWAStatus('–û—à–∏–±–∫–∞ PWA');
            });
        } else {
            updatePWAStatus('PWA –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function updatePWAStatus(text) {
            const status = document.getElementById('pwaStatus');
            if (status) status.textContent = text;
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification notification-${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ UI
        document.getElementById('installBtn').addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                document.getElementById('installBtn').style.display = 'none';
            }
            
            deferredPrompt = null;
        });
        
        // –¢–µ–º–∞
        document.getElementById('themeToggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-theme');
        }
        
        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('analysisModal').setAttribute('hidden', 'true');
        });
    </script>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script src="/app.js"></script>
</body>
</html>
